---
title: "EJ and Water"
author: "Tristen Townsend"
date: "4/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r Prepare workspace}

library(sf)
library(tidyverse)
library(leaflet)
library(mapview)

```

```{r }

Poverty_NC <- read.csv("./Data/Processed/NC_Poverty_processed.csv")

```


```{r }
#Read in Counties shapefile into an sf dataframe, filtering for just NC counties

NC_Counties_shp <- st_read(dsn = "./Data/Spatial/NC_Counties.shp") 
Landfills_shp <- st_read(dsn = "./Data/Spatial/ActivePermittedLandiflls.shp") 
IH_shp <- st_read(dsn = "./Data/Spatial/IH_Sites.shp") 
FRB_shp <- st_read(dsn = "./Data/Spatial/FRB_Sites.shp") 
BF_shp <- st_read(dsn = "./Data/Spatial/BF_Sites.shp") 
RUST_shp <- st_read(dsn = "./Data/Spatial/RUST.shp") 
HW_shp <- st_read(dsn = "./Data/Spatial/HW_Sites.shp") 


NC_gages <- st_read(dsn = "./Data/Spatial/gagesII_9322_sept30_2011.shp") %>%
  filter(STATE == "NC")

#Reveal the CRS of the counties features
st_crs(NC_Counties_shp)
st_crs(Landfills_shp)
st_crs(IH_shp)
st_crs(FRB_shp)
st_crs(BF_shp)
st_crs(RUST_shp)
st_crs(HW_shp)
st_crs(NC_gages)

#Plot the data
mapview(NC_Counties_shp) + 
  mapview(Landfills_shp, color = "black")

ggplot() + 
  geom_sf(data = NC_Counties_shp,col='red') + 
  geom_sf(data = Landfills_shp,col='blue')
```

```{r}
#Join poverty data to county shapefile
county_poverty_join <- NC_Counties_shp %>% 
  left_join(y = Poverty_NC,by = c("CO_NAME" =  "Name"))


ggplot() + 
  geom_sf(data = county_poverty_join, aes(fill=county_poverty_join$Poverty_Percent_allages)) +
  scale_fill_viridis(option = "cividis", direction = -1) +
  geom_sf(data = BF_shp, alpha = 0.4) +
 labs(fill = "% in Poverty") +
  ggtitle("Brownfield Sites in North Carolina")

ggplot() + 
  geom_sf(data = county_poverty_join, aes(fill=county_poverty_join$Poverty_Percent_allages)) +
  scale_fill_viridis(option = "cividis", direction = -1) +
  geom_sf(data = Landfills_shp) +
 labs(fill = "% in Poverty") +
  ggtitle("Landfill Sites in North Carolina")


ggplot() + 
  geom_sf(data = county_poverty_join, aes(fill=county_poverty_join$Poverty_Percent_allages)) +
  scale_fill_viridis(option = "cividis", direction = -1) +
  geom_sf(data = RUST_shp) +
 labs(fill = "% in Poverty") +
  ggtitle("RUST Sites in North Carolina")
```

```{r}

mapview(county_poverty_join, zcol = "Poverty_Percent_allages", color = viridis) 


as.data.frame(table(numbers))

ggplot() +
geom_point(x= county_poverty_join$Poverty_Percent_allages , y= )

count(Landfills_shp, Landfills_shp$County)

```